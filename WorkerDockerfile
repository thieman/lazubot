FROM thieman/clojure
MAINTAINER Travis Thieman, travis.thieman@gmail.com

RUN apt-get update
RUN apt-get install libzmq-dev -y

RUN git clone https://github.com/tthieman/lazubot.git
WORKDIR /lazubot

# firewall rules to limit network access to the zeromq port only
RUN iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
RUN iptables -A OUTPUT -p tcp --sport 8080 -j ACCEPT

# set up sandboxer user so iptables are secure
RUN useradd sandboxer
RUN passwd -d -u sandboxer
RUN mkdir /home/sandboxer
RUN chown -R sandboxer /home/sandboxer
ADD /lazubot/resources/public/java.policy /home/sandboxer/.java.policy

# run lazubot if no other arguments given to docker run
CMD lein with-profile worker run
